# User Authentication Service Requirements Document

## Introduction

사용자 인증 서비스는 이지스(Aegis) 시스템의 가장 기본적인 보안 기반 서비스로, 사용자 등록, 로그인, 토큰 관리, 기본적인 세션 관리를 담당합니다. 이 서비스는 다른 모든 서비스들이 안전하게 사용자를 식별하고 인증할 수 있는 기반을 제공합니다.

**개발 우선순위**: Phase 1 - 최우선 (다른 모든 서비스의 전제조건)

**의존성:**
- shared-library (Phase 0) - 공통 라이브러리
- infrastructure-setup (Phase 0) - PostgreSQL, Redis
- development-environment (Phase 0) - 개발 환경

## Requirements

### Requirement 1: 기본 사용자 등록

**User Story:** 소상공인으로서 이메일과 비밀번호만으로 간단하게 계정을 생성할 수 있어야 합니다.

#### Acceptance Criteria

1. WHEN 사용자가 유효한 이메일 형식으로 회원가입을 요청하면 THEN 시스템은 이메일 중복을 확인하고 계정을 생성해야 합니다
2. WHEN 사용자가 비밀번호를 입력하면 THEN 시스템은 최소 8자, 대소문자, 숫자, 특수문자 포함 여부를 검증해야 합니다
3. WHEN 계정이 생성되면 THEN 시스템은 이메일 인증 토큰을 생성하고 인증 메일을 발송해야 합니다
4. WHEN 사용자가 이메일 인증 링크를 클릭하면 THEN 시스템은 계정을 활성화하고 로그인을 허용해야 합니다
5. WHEN 이미 존재하는 이메일로 가입을 시도하면 THEN 시스템은 명확한 에러 메시지를 반환해야 합니다

### Requirement 2: 로그인 및 토큰 관리

**User Story:** 등록된 사용자로서 안전하게 로그인하고 시스템을 이용할 수 있어야 합니다.

#### Acceptance Criteria

1. WHEN 사용자가 올바른 이메일과 비밀번호로 로그인하면 THEN 시스템은 JWT 액세스 토큰과 리프레시 토큰을 발급해야 합니다
2. WHEN 사용자가 잘못된 자격증명으로 로그인을 시도하면 THEN 시스템은 실패 횟수를 기록하고 에러를 반환해야 합니다
3. WHEN 사용자가 5회 연속 로그인에 실패하면 THEN 시스템은 15분간 계정을 잠금 처리해야 합니다
4. WHEN 액세스 토큰이 만료되면 THEN 사용자는 리프레시 토큰으로 새로운 액세스 토큰을 발급받을 수 있어야 합니다
5. WHEN 사용자가 로그아웃하면 THEN 시스템은 해당 토큰을 무효화하고 세션을 종료해야 합니다

### Requirement 3: 비밀번호 관리

**User Story:** 사용자로서 비밀번호를 잊었을 때 안전하게 재설정할 수 있어야 합니다.

#### Acceptance Criteria

1. WHEN 사용자가 비밀번호 재설정을 요청하면 THEN 시스템은 등록된 이메일로 재설정 링크를 전송해야 합니다
2. WHEN 사용자가 재설정 링크를 클릭하면 THEN 시스템은 토큰의 유효성을 확인하고 비밀번호 변경 페이지를 제공해야 합니다
3. WHEN 사용자가 새 비밀번호를 입력하면 THEN 시스템은 비밀번호 정책을 검증하고 안전하게 해시하여 저장해야 합니다
4. WHEN 비밀번호 재설정이 완료되면 THEN 시스템은 기존의 모든 토큰을 무효화해야 합니다
5. WHEN 재설정 토큰이 24시간 경과하면 THEN 시스템은 해당 토큰을 자동으로 만료시켜야 합니다

### Requirement 4: 기본 프로필 관리

**User Story:** 사용자로서 기본적인 개인 정보를 관리할 수 있어야 합니다.

#### Acceptance Criteria

1. WHEN 사용자가 프로필 정보를 조회하면 THEN 시스템은 현재 저장된 기본 정보를 반환해야 합니다
2. WHEN 사용자가 이름을 업데이트하면 THEN 시스템은 변경사항을 저장하고 성공 응답을 반환해야 합니다
3. WHEN 사용자가 이메일을 변경하면 THEN 시스템은 새 이메일로 인증을 요구하고 기존 이메일은 유지해야 합니다
4. WHEN 새 이메일 인증이 완료되면 THEN 시스템은 이메일을 업데이트하고 기존 세션을 유지해야 합니다
5. WHEN 사용자가 계정 삭제를 요청하면 THEN 시스템은 확인 절차를 거쳐 계정을 비활성화해야 합니다

### Requirement 5: 세션 및 보안 관리

**User Story:** 사용자로서 내 계정이 안전하게 보호받고 있음을 확신할 수 있어야 합니다.

#### Acceptance Criteria

1. WHEN 사용자가 로그인하면 THEN 시스템은 로그인 시간, IP 주소, 디바이스 정보를 기록해야 합니다
2. WHEN 사용자가 30분간 비활성 상태이면 THEN 시스템은 자동으로 액세스 토큰을 만료시켜야 합니다
3. WHEN 새로운 디바이스에서 로그인하면 THEN 시스템은 이메일로 로그인 알림을 전송해야 합니다
4. WHEN 의심스러운 로그인 패턴이 감지되면 THEN 시스템은 추가 인증을 요구해야 합니다
5. WHEN 사용자가 활성 세션 목록을 조회하면 THEN 시스템은 현재 로그인된 모든 디바이스 정보를 제공해야 합니다

### Requirement 6: API 인증 및 권한 관리

**User Story:** 개발자로서 다른 서비스에서 사용자 인증 상태를 안전하게 확인할 수 있어야 합니다.

#### Acceptance Criteria

1. WHEN 외부 서비스가 토큰 검증을 요청하면 THEN 시스템은 토큰의 유효성과 사용자 정보를 반환해야 합니다
2. WHEN 유효하지 않은 토큰으로 요청하면 THEN 시스템은 401 Unauthorized 에러를 반환해야 합니다
3. WHEN 만료된 토큰으로 요청하면 THEN 시스템은 토큰 갱신이 필요하다는 응답을 반환해야 합니다
4. WHEN 서비스 간 통신에서 사용자 정보를 요청하면 THEN 시스템은 필요한 최소한의 정보만 제공해야 합니다
5. WHEN API 요청 빈도가 임계치를 초과하면 THEN 시스템은 레이트 리미팅을 적용해야 합니다