# Recommendation Service Requirements Document

## Introduction

추천 서비스는 이지스(Aegis) 시스템의 핵심 AI 엔진으로, 사용자의 자연어 질문과 프로필 정보를 바탕으로 최적의 정책자금을 추천하는 역할을 담당합니다. 이 서비스는 **상호작용 AI 코어(Interactive AI Core)**와 **살아있는 게이트웨이(Living Gateway)**를 통합하여, 단순한 검색을 넘어 논리적으로 검증된 맞춤형 솔루션을 제공합니다.

**개발 우선순위**: Phase 2 - AI 서비스

**의존성:**
- shared-library (Phase 0) - 공통 라이브러리
- infrastructure-setup (Phase 0) - Milvus, Neo4j, Redis
- user-service (Phase 1) - 사용자 프로필
- policy-service (Phase 1) - 정책 데이터
- search-service (Phase 2) - 검색 기능
- development-environment (Phase 0) - 개발 환경

## Requirements

### Requirement 1: 자연어 쿼리 처리 및 의도 분석

**User Story:** 사용자로서 자연스러운 한국어로 질문하면 시스템이 내 의도를 정확히 파악하여 관련 정책을 찾아줄 수 있어야 합니다.

#### Acceptance Criteria

1. WHEN 사용자가 자연어 질문을 입력하면 THEN 시스템은 질문의 의도를 분석하여 구조화된 쿼리로 변환해야 합니다
2. WHEN 질문에서 지역, 업종, 자금 규모 등의 핵심 정보를 추출하면 THEN 시스템은 개체명 인식을 통해 정확한 필터 조건을 생성해야 합니다
3. WHEN 모호하거나 불완전한 질문이 입력되면 THEN 시스템은 사용자에게 명확화 질문을 제시해야 합니다
4. WHEN 복합적인 요구사항이 포함된 질문이면 THEN 시스템은 우선순위를 파악하여 가중치를 적용해야 합니다
5. WHEN 질문 처리가 실패하면 THEN 시스템은 폴백 메커니즘을 통해 기본적인 키워드 검색을 제공해야 합니다

### Requirement 2: RAG-KG 하이브리드 검색 엔진

**User Story:** 시스템으로서 벡터 검색과 지식 그래프 추론을 결합하여 정확하고 논리적인 정책 추천을 제공할 수 있어야 합니다.

#### Acceptance Criteria

1. WHEN 사용자 쿼리를 처리하면 THEN 시스템은 Milvus에서 의미적으로 유사한 정책들을 벡터 검색으로 찾아야 합니다
2. WHEN 벡터 검색 결과를 얻으면 THEN 시스템은 Neo4j 지식 그래프에서 사용자 자격 요건과 정책 조건을 추론해야 합니다
3. WHEN 지식 그래프 추론을 수행하면 THEN 시스템은 정책 간 관계, 선행 조건, 배타적 조건을 고려해야 합니다
4. WHEN 검색 결과를 통합하면 THEN 시스템은 KMRR 알고리즘을 사용하여 최종 순위를 결정해야 합니다
5. WHEN 검색 성능이 중요하면 THEN 시스템은 3초 이내에 추천 결과를 반환해야 합니다

### Requirement 3: S.C.O.R.E. 프레임워크 기반 설명 생성

**User Story:** 사용자로서 왜 이 정책이 추천되었는지 명확하고 이해하기 쉬운 설명을 받을 수 있어야 합니다.

#### Acceptance Criteria

1. WHEN 추천 결과를 생성하면 THEN 시스템은 각 정책의 추천 근거를 S.C.O.R.E. 프레임워크에 따라 설명해야 합니다
2. WHEN 적합성을 설명하면 THEN 시스템은 사용자 프로필과 정책 조건의 매칭 정도를 정량적으로 제시해야 합니다
3. WHEN 점수를 분해하면 THEN 시스템은 의미적 유사도, 자격 요건 매칭, 비즈니스 규칙 적용 등의 세부 점수를 제공해야 합니다
4. WHEN 주의사항을 제시하면 THEN 시스템은 신청 시 고려해야 할 조건이나 제약사항을 명시해야 합니다
5. WHEN 설명을 생성하면 THEN 시스템은 일반 사용자가 이해할 수 있는 쉬운 언어로 표현해야 합니다

### Requirement 4: 사용자 프로필 기반 개인화

**User Story:** 사용자로서 내 사업 정보와 상황에 맞는 맞춤형 정책 추천을 받을 수 있어야 합니다.

#### Acceptance Criteria

1. WHEN 사용자 프로필 정보를 활용하면 THEN 시스템은 업종, 지역, 사업 규모, 설립일 등을 고려하여 필터링해야 합니다
2. WHEN 사용자의 과거 관심 정책을 분석하면 THEN 시스템은 선호도를 학습하여 추천에 반영해야 합니다
3. WHEN 사용자의 현재 자금 상황을 고려하면 THEN 시스템은 신청 가능한 정책만을 우선적으로 추천해야 합니다
4. WHEN 사용자가 이미 신청한 정책이 있으면 THEN 시스템은 중복 신청을 방지하고 관련 정책을 제안해야 합니다
5. WHEN 개인화 정보가 부족하면 THEN 시스템은 점진적으로 정보를 수집하여 추천 품질을 개선해야 합니다

### Requirement 5: 실시간 추천 및 캐싱

**User Story:** 사용자로서 빠른 응답 시간으로 실시간 추천을 받을 수 있어야 합니다.

#### Acceptance Criteria

1. WHEN 동일한 쿼리가 반복되면 THEN 시스템은 Redis 캐시를 활용하여 1초 이내에 결과를 반환해야 합니다
2. WHEN 사용자 프로필이 유사한 경우 THEN 시스템은 프로필 기반 캐싱을 통해 응답 속도를 향상시켜야 합니다
3. WHEN 정책 데이터가 업데이트되면 THEN 시스템은 관련 캐시를 즉시 무효화하여 최신 정보를 반영해야 합니다
4. WHEN 시스템 부하가 높으면 THEN 시스템은 캐시 우선 전략을 통해 서비스 안정성을 유지해야 합니다
5. WHEN 캐시 미스가 발생하면 THEN 시스템은 백그라운드에서 캐시를 미리 생성하여 다음 요청에 대비해야 합니다

### Requirement 6: 추천 피드백 및 학습

**User Story:** 사용자로서 추천 결과에 대한 피드백을 제공하여 시스템이 더 나은 추천을 할 수 있도록 도울 수 있어야 합니다.

#### Acceptance Criteria

1. WHEN 사용자가 추천 결과를 평가하면 THEN 시스템은 별점, 유용성, 정확성 등의 피드백을 수집해야 합니다
2. WHEN 사용자가 특정 정책을 클릭하거나 신청하면 THEN 시스템은 암시적 피드백으로 선호도를 학습해야 합니다
3. WHEN 피드백 데이터가 축적되면 THEN 시스템은 추천 알고리즘의 가중치를 동적으로 조정해야 합니다
4. WHEN 부정적 피드백을 받으면 THEN 시스템은 해당 추천 패턴을 분석하여 개선점을 식별해야 합니다
5. WHEN 피드백 기반 학습을 수행하면 THEN 시스템은 A/B 테스트를 통해 개선 효과를 검증해야 합니다

### Requirement 7: 다중 LLM 지원 및 폴백

**User Story:** 시스템으로서 외부 LLM 서비스의 장애나 성능 저하에 대응하여 안정적인 서비스를 제공할 수 있어야 합니다.

#### Acceptance Criteria

1. WHEN 주 LLM 서비스가 정상 작동하면 THEN 시스템은 최고 품질의 자연어 처리를 제공해야 합니다
2. WHEN 주 LLM 서비스가 실패하면 THEN 시스템은 자동으로 백업 LLM으로 전환해야 합니다
3. WHEN 모든 외부 LLM이 실패하면 THEN 시스템은 규칙 기반 처리로 폴백하여 기본 기능을 유지해야 합니다
4. WHEN LLM 응답 품질이 저하되면 THEN 시스템은 응답을 검증하고 필요시 재시도해야 합니다
5. WHEN LLM 서비스를 전환하면 THEN 시스템은 사용자 경험의 일관성을 최대한 유지해야 합니다

### Requirement 8: 추천 세션 관리

**User Story:** 사용자로서 대화형 추천을 통해 점진적으로 더 정확한 결과를 얻을 수 있어야 합니다.

#### Acceptance Criteria

1. WHEN 사용자가 추천 세션을 시작하면 THEN 시스템은 세션 컨텍스트를 생성하고 대화 이력을 관리해야 합니다
2. WHEN 사용자가 추가 질문을 하면 THEN 시스템은 이전 대화 내용을 고려하여 맥락적 추천을 제공해야 합니다
3. WHEN 사용자가 추천 결과를 좁히고 싶으면 THEN 시스템은 대화형 필터링을 통해 조건을 세분화해야 합니다
4. WHEN 세션이 길어지면 THEN 시스템은 중요한 정보를 요약하여 컨텍스트를 유지해야 합니다
5. WHEN 세션이 종료되면 THEN 시스템은 세션 데이터를 분석하여 사용자 프로필을 업데이트해야 합니다

### Requirement 9: 추천 결과 다양성 및 공정성

**User Story:** 사용자로서 다양한 옵션을 제공받고, 특정 기관이나 정책에 편향되지 않은 공정한 추천을 받을 수 있어야 합니다.

#### Acceptance Criteria

1. WHEN 추천 결과를 생성하면 THEN 시스템은 다양한 발행기관의 정책을 균형있게 포함해야 합니다
2. WHEN 유사한 정책들이 많으면 THEN 시스템은 다양성 알고리즘을 적용하여 중복을 줄여야 합니다
3. WHEN 특정 기관의 정책이 과도하게 추천되면 THEN 시스템은 공정성 지표를 통해 균형을 조정해야 합니다
4. WHEN 사용자가 다양한 옵션을 원하면 THEN 시스템은 리스크 수준, 지원 형태, 신청 난이도 등을 다양화해야 합니다
5. WHEN 추천 공정성을 평가하면 THEN 시스템은 정기적으로 편향성 지표를 모니터링하고 보고해야 합니다

### Requirement 10: 성능 모니터링 및 최적화

**User Story:** 시스템 관리자로서 추천 시스템의 성능을 모니터링하고 지속적으로 최적화할 수 있어야 합니다.

#### Acceptance Criteria

1. WHEN 추천 요청을 처리하면 THEN 시스템은 응답 시간, 정확도, 사용자 만족도 등의 메트릭을 수집해야 합니다
2. WHEN 성능 지표가 임계값을 벗어나면 THEN 시스템은 자동으로 알림을 발송하고 대응 방안을 제시해야 합니다
3. WHEN 추천 품질이 저하되면 THEN 시스템은 원인을 분석하고 자동 튜닝을 수행해야 합니다
4. WHEN 사용 패턴이 변화하면 THEN 시스템은 적응적으로 알고리즘 파라미터를 조정해야 합니다
5. WHEN 성능 최적화를 수행하면 THEN 시스템은 A/B 테스트를 통해 개선 효과를 검증해야 합니다